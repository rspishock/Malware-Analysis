#! /usr/bin/python
from os import path

import argparse
import re
import sys


def get_arguments():
    """Get user supplied arguments from terminal."""
    parser = argparse.ArgumentParser()
    parser.add_argument('-i', '--input', dest='input', help='File to parse strings from.')
    parser.add_argument('-o', '--output', dest='output', help='File to write parsed strings to.')
    parser.add_argument('-d', '--descriptor', dest='descriptor', help='Malware descriptor.  Will be used to append '
                                                                      'regex outputs to')
    (options) = parser.parse_args()

    return options


# argument variables
options = get_arguments()
input_file = options.input
output_file = options.output
descriptor = options.descriptor

# user variables
path_count = 0
dll_count = 0
crypto_count = 0

try:
    if path.exists(input_file):
        # file to read from
        with open(input_file) as file_object:
            with open(f'{descriptor}.dll.txt', 'w') as output:
                output.write("Found .dll files:\n")
                for line in file_object:
                    # dll regex
                    dll_regex = re.compile(f'[a-zA-Z0-9-_]*\.dll')
                    dll_string = dll_regex.search(line)
                    print(dll_string)

                    # write dll files to file_out.txt
                    output.write(f'\t{dll_string}\n')

                # for line in file_object:
                    # # increment dll count
                    # dll_count + 1
                    #
                    # output_file.write(f'Total number of .dll files found: {dll_count}')
                    #
                    # # file path regex
                    # path_regex = re.compile(f'C:\\[a-z0-9]\\')
                    # path_string = path_regex.search(line)
                    #
                    # # increment path count
                    # path_count + 

                    # crypto regex

            # total number of dll files found
            print(f'Found {dll_count} dll files.  Check ')

# except IOError:
    else:
        print(f'File {input_file} does not exist.')
        print('Check filename and rerun script.')
        sys.exit()

except IOError:
    sys.exit
